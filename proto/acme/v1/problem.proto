// Copyright (c) 2024-2026 Apptly Software Ltd <oss@apptly.co>
// SPDX-License-Identifier: MIT
//
// ACME Problem Details (RFC 7807, RFC 8555)

syntax = "proto3";

package acme.v1;

option go_package = "darvaza.org/wilee/pkg/specs/acme/v1";

import "acme/v1/acme.proto";

// ErrorType specifies the ACME error type.
// RFC 8555 §9.7.4
enum ErrorType {
  // Unspecified error type.
  ERROR_TYPE_UNSPECIFIED = 0;
  // The request specified an account that does not exist.
  ERROR_TYPE_ACCOUNT_DOES_NOT_EXIST = 1;
  // The request specified a certificate to be revoked that has already been revoked.
  ERROR_TYPE_ALREADY_REVOKED = 2;
  // The CSR is unacceptable.
  ERROR_TYPE_BAD_CSR = 3;
  // The client sent an unacceptable anti-replay nonce.
  ERROR_TYPE_BAD_NONCE = 4;
  // The JWS was signed with a public key the server does not support.
  ERROR_TYPE_BAD_PUBLIC_KEY = 5;
  // The revocation reason provided is not allowed by the server.
  ERROR_TYPE_BAD_REVOCATION_REASON = 6;
  // The JWS was signed with an algorithm the server does not support.
  ERROR_TYPE_BAD_SIGNATURE_ALGORITHM = 7;
  // CAA records forbid the CA from issuing a certificate.
  ERROR_TYPE_CAA = 8;
  // Specific error conditions are indicated in subproblems.
  ERROR_TYPE_COMPOUND = 9;
  // The server could not connect to validation target.
  ERROR_TYPE_CONNECTION = 10;
  // There was a problem with a DNS query during identifier validation.
  ERROR_TYPE_DNS = 11;
  // The request must include a value for the externalAccountBinding field.
  ERROR_TYPE_EXTERNAL_ACCOUNT_REQUIRED = 12;
  // Response received did not match the challenge's requirements.
  ERROR_TYPE_INCORRECT_RESPONSE = 13;
  // A contact URL for an account was invalid.
  ERROR_TYPE_INVALID_CONTACT = 14;
  // The request message was malformed.
  ERROR_TYPE_MALFORMED = 15;
  // The request attempted to finalise an order that is not ready.
  ERROR_TYPE_ORDER_NOT_READY = 16;
  // The request exceeds a rate limit.
  ERROR_TYPE_RATE_LIMITED = 17;
  // The server will not issue certificates for the identifier.
  ERROR_TYPE_REJECTED_IDENTIFIER = 18;
  // The server experienced an internal error.
  ERROR_TYPE_SERVER_INTERNAL = 19;
  // The server received a TLS error during validation.
  ERROR_TYPE_TLS = 20;
  // The client lacks sufficient authorisation.
  ERROR_TYPE_UNAUTHORIZED = 21;
  // A contact URL used an unsupported protocol scheme.
  ERROR_TYPE_UNSUPPORTED_CONTACT = 22;
  // An identifier is of an unsupported type.
  ERROR_TYPE_UNSUPPORTED_IDENTIFIER = 23;
  // Visit the "instance" URL and take actions specified there.
  ERROR_TYPE_USER_ACTION_REQUIRED = 24;
}

// Problem represents an error response.
// RFC 7807 §3, RFC 8555 §6.7
message Problem {
  // URI reference that identifies the problem type.
  ErrorType type = 1;
  // Short, human-readable summary of the problem type.
  string title = 2;
  // HTTP status code generated by the origin server.
  int32 status = 3;
  // Human-readable explanation specific to this occurrence.
  string detail = 4;
  // URI reference that identifies the specific occurrence.
  string instance = 5;
  // Array of problems applying to specific identifiers (§6.7.1).
  repeated Subproblem subproblems = 6;
}

// Subproblem represents a component error within a Problem.
// RFC 8555 §6.7.1
message Subproblem {
  // URI reference that identifies the problem type.
  ErrorType type = 1;
  // Human-readable explanation specific to this subproblem.
  string detail = 2;
  // The identifier to which this subproblem refers.
  Identifier identifier = 3;
}
